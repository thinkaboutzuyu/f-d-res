(this["webpackJsonpfacemask-detection"]=this["webpackJsonpfacemask-detection"]||[]).push([[0],{327:function(e,t,n){},333:function(e,t){},334:function(e,t){},342:function(e,t){},352:function(e,t){},353:function(e,t){},354:function(e,t){},355:function(e,t){},363:function(e,t){},364:function(e,t,n){},369:function(e,t,n){"use strict";n.r(t);var a=n(11),c=n.n(a),r=n(132),i=n.n(r),s=(n(327),n(12)),o=n(4),l=n(5),u=n.n(l),d=n(417),f=n(415),h=n(420),b=n(418),g=n(414),m=n(412),j=n(416),v=n(86),p=n(313),x=n.n(p),O=(n(364),{root:{height:"100vh",width:"100vw",display:"flex",alignItems:"stretch",backgroundColor:"#E6EE9C",flexDirection:"column"},webCamParentPanel:{width:"100%",backgroundColor:"#C5CAE9",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",margin:0,padding:0,gap:0},webCamPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},settingPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},faceMaskPanel:{display:"flex",backgroundColor:"#BBDEFB",justifyContent:"space-evenly",alignItems:"center",margin:0,padding:0,gap:0},faceMaskContainer:{display:"flex",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0,flexDirection:"column"},webCamStackItem:{position:"absolute",top:0,left:0,marginLeft:"auto"}});function w(){var e=window.visualViewport;return{width:e.width,height:e.height}}var y=function(e,t,n,a,c,r,i){for(var s=[],o=0,l=e.length;o<l&&!(e[o]<t);){var u=[],d=n[0][o][0]*a,f=n[0][o][1]*c,h=n[0][o][2]*a,b=n[0][o][3]*c;u[0]=f,u[1]=d,u[2]=b-f,u[3]=h-d;var g=parseInt(n[0][o][0]*r),m=parseInt(n[0][o][1]*i),j=[g,m,parseInt(n[0][o][2]*r)-g+1,parseInt(n[0][o][3]*i)-m+1];s.push({label:"face",score:e[o],bbox:u,slideBox:j,cropBox:n[0][o],boxInd:o}),o++}return s},I=function(){var e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return console.log("enumerateDevices() not supported."),e.abrupt("return",[{deviceName:null,deviceId:null}]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0,a=e.length;n<a;)"videoinput"===e[n].kind&&t.push({deviceName:e[n].label,deviceId:e[n].deviceId}),n++;return t})).catch((function(e){return console.log(e.name+": "+e.message),[{deviceName:null,deviceId:null}]}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var k=n(19),C=[16/9,4/3],S="".concat("/facemask-detection-res","/tfjs/face_detection/model.json"),W="".concat("/facemask-detection-res","/tfjs/face_mask_classification/model.json"),F="".concat("/facemask-detection-res","/test_imgs/mask_01.jpg");var N=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(Array(5).fill(0)),n=Object(a.useState)(0),c=Object(o.a)(n,2),r=c[0],i=c[1],l=Object(a.useState)(0),p=Object(o.a)(l,2),N=p[0],P=p[1],D=Object(a.useState)([]),E=Object(o.a)(D,2),B=E[0],H=E[1],M=Object(a.useState)([]),R=Object(o.a)(M,2),A=R[0],L=R[1],_=Object(a.useState)(null),z=Object(o.a)(_,2),V=z[0],J=z[1],T=Object(a.useState)(null),Q=Object(o.a)(T,2),q=Q[0],G=Q[1],K=Object(a.useState)({}),U=Object(o.a)(K,2),X=U[0],Y=U[1],Z=Object(a.useState)(!1),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)({deviceName:"",deviceId:""}),ae=Object(o.a)(ne,2),ce=ae[0],re=ae[1],ie=Object(a.useState)([]),se=Object(o.a)(ie,2),oe=se[0],le=se[1],ue=function(){var e=Object(a.useState)(w()),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){function e(){c(w())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),de=ue.height,fe=ue.width,he=function(e,t,n,a,c){var r=e*n/100,i=t*a/100,s=i/c[0],o=r*c[0],l=r,u=i;return s>r?u=o:l=s,{webCamPanelWidth:i,webCamPanelHeight:r,expectedWebCamWidth:u,expectedWebCamHeight:l}}(de,fe,65,70,C),be=he.webCamPanelWidth,ge=he.webCamPanelHeight,me=he.expectedWebCamWidth,je=he.expectedWebCamHeight,ve=function(e,t,n,a){var c=e/t,r=n/c,i=a,s=n;return r>a?s=a*c:i=r,{expectedImgWidth:s,expectedImgHeight:i}}(void 0!==X.oriImgWidth?X.oriImgWidth:0,void 0!==X.oriImgHeight?X.oriImgHeight:1,be,ge),pe=ve.expectedImgWidth,xe=ve.expectedImgHeight,Oe=35*de/100*.5,we={height:720,width:1280,deviceId:ce.deviceId},ye=function(){var e=Object(s.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==V&&V.dispose(),null!==q&&q.dispose(),e.next=4,v.e(S,{onProgress:function(e){i(e)}});case 4:return t=e.sent,e.next=7,v.e(W,{onProgress:function(e){P(e)}});case 7:return n=e.sent,J(t),G(n),console.log("Model loaded."),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var n=Object(s.a)(u.a.mark((function n(a,c){var r,i,s,o,l,d,f,h,b;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=a&&null!=c){n.next=2;break}return n.abrupt("return");case 2:if("undefined"===typeof e.current||null===e.current||4!==e.current.video.readyState){n.next=15;break}i=e.current.video,r=document.getElementById("myCanvas"),e.current.video.width=me,e.current.video.height=je,r.width=me,r.height=je,s=je,o=me,l=720,d=1280,n.next=16;break;case 15:return n.abrupt("return");case 16:f=r.getContext("2d"),"16px sans-serif",f.font="16px sans-serif",f.textBaseline="top",h=v.a.fromPixels(i),b=v.g((function(){return h.transpose([0,1,2]).expandDims()})),a.executeAsync(b).then((function(e){var n,a,r,i=e[4].arraySync(),u=e[6].dataSync(),b=y(u,.5,i,s,o,l,d),g=Array(5).fill(null),m=Array(5).fill(null);if(b.length>0){for(n=0,a=b.length,r=5,f.clearRect(0,0,je,me);n<a;){var j=b[n].bbox[0],p=b[n].bbox[1],x=b[n].bbox[2],O=b[n].bbox[3];f.strokeStyle="#00FFFF",f.lineWidth=2,f.strokeRect(j,p,x,O),n<r&&(g[n]=b[n].score),n++}var w=b.map((function(e,t){return e.cropBox})),I=b.map((function(e,t){return e.boxInd})),k=v.g((function(){var e=h.tile([I.length,1,1]).reshape([-1,h.shape[0],h.shape[1],3]);return v.d.cropAndResize(e,w,I,[224,224],"bilinear")})),C=v.g((function(){return c.execute(k).arraySync()}));n=0,a=t.current.length,r=b.length;for(var S=k.arraySync();n<a;){if(n<r){var W=t.current[n];v.a.toPixels(S[n],W),m[n]=C[n][0]}else{t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height)}n++}k.dispose()}else for(f.clearRect(0,0,je,me),n=0,a=t.current.length;n<a;){t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height),n++}return H(g),L(m),e})).then((function(e){for(var t=0,n=e.length;t<n;)v.b(e[t]),t++})).finally((function(){v.b(h),v.b(b)}));case 23:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return Object(a.useEffect)((function(){v.f().then((function(e){v.c(),console.log("tfjs is ready")})).then(ye)}),[]),Object(a.useEffect)((function(){if(null!==V&&null!==q){if(ee){var e=setInterval(Ie,100,V,q);return function(){return clearInterval(e)}}console.log("Run on test img"),Ie(V,q)}}),[q,V,de,fe,ee,X]),Object(a.useEffect)((function(){if(!ee){var e=new Image;e.src=F,e.onload=function(){Y({oriImgHeight:e.naturalHeight,oriImgWidth:e.naturalWidth})}}}),[ee]),Object(a.useEffect)((function(){H(Array(5).fill(null)),L(Array(5).fill(null))}),[5]),Object(a.useEffect)((function(){I().then((function(e){le(e),e.length>0&&re(e[0])}))}),[ee]),Object(k.jsxs)("div",{className:"App",children:[Object(k.jsxs)("div",{style:{flexBasis:"".concat(65,"%")},className:"web-cam-parent-panel",children:[Object(k.jsxs)("div",{style:{flexBasis:"".concat(70,"%")},children:[ee&&Object(k.jsxs)("div",{className:"web-cam-panel",children:[Object(k.jsx)(x.a,{audio:!1,style:{width:me},className:"web-cam-stack-item",id:"img",ref:e,width:me,screenshotQuality:1,screenshotFormat:"image/jpeg",videoConstraints:we}),Object(k.jsx)("canvas",{id:"myCanvas",width:me,style:{zIndex:9999,backgroundColor:"transparent"},className:"web-cam-stack-item"})]}),!ee&&Object(k.jsxs)("div",{className:"web-cam-panel",children:[Object(k.jsx)("img",{id:"test_img",src:F,style:{height:xe,width:pe},className:"web-cam-stack-item",height:xe,width:pe,alt:""}),Object(k.jsx)("canvas",{id:"test_canvas",height:xe,width:pe,style:{zIndex:9999,backgroundColor:"transparent"},className:"web-cam-stack-item"})]})]}),Object(k.jsx)("div",{style:{flexBasis:"".concat(30,"%")},className:"setting-panel",children:Object(k.jsxs)(h.a,{style:{width:"100%",backgroundColor:"red"},children:[Object(k.jsxs)(d.a,{size:"small",style:{width:"100%"},children:[Object(k.jsx)(b.a,{id:"demo-simple-select-autowidth-label",children:"Video Input"}),Object(k.jsx)(m.a,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:ce.deviceId,onChange:function(e){re({deviceName:e.target.name,deviceId:e.target.value})},autoWidth:!0,label:"Video Input",children:oe.length>0?oe.map((function(e,t){return Object(k.jsx)(g.a,{value:e.deviceId,children:e.deviceName},t)})):Object(k.jsx)(g.a,{value:"",children:""})})]}),Object(k.jsx)(f.a,{control:Object(k.jsx)(j.a,{checked:ee,onChange:function(e){te(e.target.checked)},inputProps:{"aria-label":"controlled"}}),label:"Webcam",labelPlacement:"start",style:{marginLeft:"0",marginRight:"0"}})]})})]}),Object(k.jsx)("div",{style:{flexBasis:"".concat(35,"%")},className:"face-mask-panel",children:function(){if(null==V||null==q){var e="Face Detection Model - ".concat(100*r,"%"),n="Mask Classifier Model - ".concat(100*N,"%");return Object(k.jsxs)("div",{children:[Object(k.jsx)("div",{children:"Loading models...."}),Object(k.jsx)("div",{children:e}),Object(k.jsx)("div",{children:n})]})}return t.current.length<1?Object(k.jsx)("div",{children:"Warming up...."}):t.current.map((function(e,n){var a="";return null!==B[n]&&void 0!==B[n]&&null!==A[n]&&void 0!==A[n]&&(a=A[n]>0?"No Mask":"Mask"),Object(k.jsxs)("div",{style:O.faceMaskContainer,children:[Object(k.jsx)("div",{children:a}),Object(k.jsx)("canvas",{ref:function(e){return t.current[n]=e},height:Oe,width:Oe,style:{height:Oe,width:Oe}}),Object(k.jsx)("div",{children:""}),Object(k.jsx)("div",{children:""})]},n)}))}()})]})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,421)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(N,{})}),document.getElementById("root")),P()}},[[369,1,2]]]);
//# sourceMappingURL=main.28bb811d.chunk.js.map